<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ZERO_DAY // PORTFOLIO_ENV</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        body { margin: 0; overflow: hidden; background: #000; font-family: 'Share Tech Mono', monospace; }
        
        /* UI OVERLAYS */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        
        /* CRT SCANLINES */
        .scanlines {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            width: 100%; height: 100%; position: absolute; pointer-events: none;
        }

        /* BLOCKER (Start Screen) */
        #blocker {
            position: absolute; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #00ffcc; z-index: 20; pointer-events: auto; cursor: pointer;
        }
        #instructions { font-size: 24px; text-align: center; line-height: 1.5; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        /* HUD ELEMENTS */
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
            border: 2px solid rgba(0, 255, 204, 0.5); transform: translate(-50%, -50%); border-radius: 50%;
        }
        
        #zone-info {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 10, 10, 0.8); border: 1px solid #00ffcc;
            padding: 15px 30px; color: #00ffcc; text-transform: uppercase;
            display: none; box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
        }

        /* DATA TERMINAL (Modal) */
        #terminal {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60%; max-width: 800px; height: 60%; background: rgba(5, 5, 5, 0.95);
            border: 2px solid #00ffcc; box-shadow: 0 0 50px rgba(0, 255, 204, 0.3);
            z-index: 30; padding: 20px; overflow: hidden; pointer-events: auto;
        }
        #terminal-header { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; color: #00ffcc; }
        #terminal-content { color: #ccc; font-size: 18px; line-height: 1.6; height: 80%; overflow-y: auto; }
        #terminal-content h2 { color: #fff; margin-top: 0; }
        .close-btn { cursor: pointer; color: #ff0055; font-weight: bold; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #00ffcc; }

        .glitch {
            animation: glitch 0.15s infinite;
        }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="scanlines"></div>
        <div id="crosshair"></div>
        <div id="zone-info">Press [E] to Access Node</div>
    </div>

    <div id="blocker">
        <div id="instructions">
            <h1 style="font-size: 40px; text-shadow: 0 0 10px #00ffcc;">SYSTEM INITIALIZED</h1>
            <p>CLICK TO JACK IN</p>
            <p class="blink" style="font-size: 14px; color: #888;">(W, A, S, D = Move // MOUSE = Look)</p>
        </div>
    </div>

    <div id="terminal">
        <div id="terminal-header">
            <span id="term-title">/// DATA_NODE_01</span>
            <span class="close-btn" onclick="closeTerminal()">[X] CLOSE CONNECTION</span>
        </div>
        <div id="terminal-content">
            </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        let camera, scene, renderer, controls, composer;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let raycaster;
        
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();
        const objects = []; // For collision/interaction
        const zones = []; // Special interactive zones
        
        // ZONE CONFIGURATION
        const zoneData = [
            { id: 1, title: "SPAWN // IDENTITY", color: 0xffffff, x: 0, z: -10, content: "<h2>USER: PENTESTER_01</h2><p>Welcome to my digital construct.</p><p>I am a cybersecurity specialist focusing on offensive security, network penetration, and red team operations.</p><p>Explore this server to view my tools, logs, and simulated environments.</p>" },
            { id: 2, title: "OPS // SKILLS", color: 0x00ffcc, x: -20, z: -30, content: "<h2>OPERATIONS CAPABILITIES</h2><ul><li>> Network Penetration Testing</li><li>> Web Application Security (OWASP Top 10)</li><li>> Python / Go Scripting</li><li>> Burp Suite Professional</li><li>> Metasploit Framework</li><li>> Reverse Engineering</li></ul>" },
            { id: 3, title: "VAULT // PROJECTS", color: 0xaa00ff, x: 20, z: -30, content: "<h2>ENCRYPTED ARCHIVES</h2><p><b>Project: Hydra-Net</b><br>Automated vulnerability scanner for IoT devices.</p><hr><p><b>Project: Shadow_Walk</b><br>Custom C2 framework designed for stealth data exfiltration simulation.</p><hr><p><b>CVE-2023-XXXX</b><br>Discovered critical IDOR vulnerability in major fintech API.</p>" },
            { id: 4, title: "SIM // LABS", color: 0xffaa00, x: 0, z: -60, content: "<h2>SIMULATION ROOM</h2><p>Active CTF Progress:</p><p>[ HackTheBox ] Rank: Guru</p><p>[ TryHackMe ] Top 1%</p><br><p>> Click here to launch WebGL Terminal Simulation (Coming Soon)</p>" },
            { id: 5, title: "EXIT // CONTACT", color: 0xff0055, x: 0, z: 20, content: "<h2>TERMINATE SESSION?</h2><p>Reach me via secure channels:</p><p>> Email: secure@pentester.io</p><p>> PGP Key: 0xDEADBEEF</p><p>> LinkedIn / Twitter / Github</p>" }
        ];

        let prevTime = performance.now();
        let activeZone = null;

        init();
        animate();

        function init() {
            // SCENE
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505);
            scene.fog = new THREE.FogExp2(0x050505, 0.02);

            // CAMERA
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 1.6; // Eye level

            // LIGHTS
            const ambientLight = new THREE.AmbientLight(0x404040); // Soft white light
            scene.add(ambientLight);

            // FLOOR (Grid)
            const gridHelper = new THREE.GridHelper(200, 100, 0x333333, 0x111111);
            scene.add(gridHelper);
            
            // FLOOR (Reflection Plane - purely aesthetic)
            const planeGeometry = new THREE.PlaneGeometry(200, 200);
            const planeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000, side: THREE.DoubleSide });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = -Math.PI / 2;
            plane.position.y = -0.1;
            scene.add(plane);

            // CONTROLS
            controls = new PointerLockControls(camera, document.body);

            const blocker = document.getElementById('blocker');
            const instructions = document.getElementById('instructions');

            blocker.addEventListener('click', function () {
                controls.lock();
            });

            controls.addEventListener('lock', function () {
                instructions.style.display = 'none';
                blocker.style.display = 'none';
            });

            controls.addEventListener('unlock', function () {
                // Only show blocker if terminal is NOT open
                if(document.getElementById('terminal').style.display !== 'block') {
                    blocker.style.display = 'flex';
                    instructions.style.display = '';
                }
            });

            scene.add(controls.getObject());

            // KEYBOARD INPUT
            const onKeyDown = function (event) {
                switch (event.code) {
                    case 'ArrowUp': case 'KeyW': moveForward = true; break;
                    case 'ArrowLeft': case 'KeyA': moveLeft = true; break;
                    case 'ArrowDown': case 'KeyS': moveBackward = true; break;
                    case 'ArrowRight': case 'KeyD': moveRight = true; break;
                    case 'KeyE': interact(); break;
                }
            };

            const onKeyUp = function (event) {
                switch (event.code) {
                    case 'ArrowUp': case 'KeyW': moveForward = false; break;
                    case 'ArrowLeft': case 'KeyA': moveLeft = false; break;
                    case 'ArrowDown': case 'KeyS': moveBackward = false; break;
                    case 'ArrowRight': case 'KeyD': moveRight = false; break;
                }
            };

            document.addEventListener("keydown", (e) => {
                if (e.code === "Escape" && document.getElementById("terminal").style.display === "block") {
                    e.preventDefault();
                }
            });


            // WORLD BUILDING (Cyber City)
            buildWorld();

            // RENDERER
            renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // POST PROCESSING (Bloom)
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
            bloomPass.threshold = 0;
            bloomPass.strength = 1.2; // GLOW INTENSITY
            bloomPass.radius = 0.5;

            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // RESIZE HANDLER
            window.addEventListener('resize', onWindowResize);
        }

        function buildWorld() {
            // Build Zones (The Monoliths)
            const boxGeo = new THREE.BoxGeometry(2, 6, 2);
            
            zoneData.forEach(zone => {
                // Create glowing pillar
                const mat = new THREE.MeshBasicMaterial({ color: zone.color, wireframe: true });
                const mesh = new THREE.Mesh(boxGeo, mat);
                mesh.position.set(zone.x, 3, zone.z);
                
                // Add an inner glowing core
                const coreGeo = new THREE.BoxGeometry(1.5, 5.5, 1.5);
                const coreMat = new THREE.MeshBasicMaterial({ color: zone.color, transparent: true, opacity: 0.3 });
                const core = new THREE.Mesh(coreGeo, coreMat);
                mesh.add(core);

                // Add Point Light
                const light = new THREE.PointLight(zone.color, 15, 20);
                light.position.set(0, 0, 0);
                mesh.add(light);

                // Add floating text label
                // (Simplified: we use the UI overlay for text to save performance/complexity)

                mesh.userData = { id: zone.id, isZone: true, visited: false };
                scene.add(mesh);
                zones.push(mesh);
            });

            // Random Background Structures (The City)
            const cityGeo = new THREE.BoxGeometry(1, 1, 1);
            const cityMat = new THREE.MeshBasicMaterial({ color: 0x111111 });
            const edgeMat = new THREE.LineBasicMaterial({ color: 0x004400 });

            for (let i = 0; i < 100; i++) {
                // Don't spawn close to center
                let x = (Math.random() - 0.5) * 200;
                let z = (Math.random() - 0.5) * 200;
                if (Math.abs(x) < 20 && Math.abs(z) < 20) continue;

                const h = Math.random() * 20 + 5;
                const building = new THREE.Mesh(cityGeo, cityMat);
                building.position.set(x, h/2, z);
                building.scale.set(Math.random() * 5 + 2, h, Math.random() * 5 + 2);
                
                // Add edges for wireframe look
                const edges = new THREE.EdgesGeometry(building.geometry);
                const line = new THREE.LineSegments(edges, edgeMat);
                building.add(line);

                scene.add(building);
                objects.push(building); // Add to collision list (optional, simplistic)
            }
        }

            function interact() {
                if (!activeZone.userData.visited) {
                activeZone.material.color.set(0x00ff00); // completed color
                activeZone.userData.visited = true;
            }

                controls.unlock();

                const zone = zoneData.find(z => z.id === activeZone.userData.id);
                const terminal = document.getElementById('terminal');
                const content = document.getElementById('terminal-content');

                document.getElementById('term-title').innerText = "/// " + zone.title;
                terminal.style.display = 'block';
                document.getElementById('zone-info').style.display = 'none';

                typeText(content, zone.content);
            }

        // Global function for close button
        window.closeTerminal = function() {
            document.getElementById('terminal').style.display = 'none';
            controls.lock(); // Re-engage mouse
        };

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = performance.now();
            const delta = (time - prevTime) / 1000;

            if (controls.isLocked) {
                // MOVEMENT LOGIC
                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize(); // Ensure consistent speed in all directions

                if (moveForward || moveBackward) velocity.z -= direction.z * 100.0 * delta; // Speed
                if (moveLeft || moveRight) velocity.x -= direction.x * 100.0 * delta;

                controls.moveRight(-velocity.x * delta);
                velocity.clampLength(0, 20);
                controls.moveForward(-velocity.z * delta);

                // Simple floor collision
                if (controls.getObject().position.y < 1.6) {
                    velocity.y = 0;
                    controls.getObject().position.y = 1.6;
                }
            }

            // CHECK ZONES PROXIMITY
            const playerPos = controls.getObject().position;
            let foundZone = null;

            zones.forEach(zone => {
                // Rotate zones for cool effect
                zone.rotation.y += delta * 0.5;
                
                // Distance Check
                const dist = playerPos.distanceTo(zone.position);
                if (dist < 8) { // Activation radius
                    foundZone = zone;
                }
            });

            if (foundZone) {
                activeZone = foundZone;
                document.getElementById('zone-info').style.display = 'block';
                const zData = zoneData.find(z => z.id === foundZone.userData.id);
                document.getElementById('zone-info').innerText = `PRESS [E] ACCESS: ${zData.title}`;
            } else {
                activeZone = null;
                document.getElementById('zone-info').style.display = 'none';
            }

            prevTime = time;

            // RENDER WITH BLOOM
            composer.render();
        }

                function typeText(el, html, speed = 15) {
            el.innerHTML = "";
            let i = 0;
            const temp = document.createElement("div");
            temp.innerHTML = html;
            const text = temp.textContent;

            const interval = setInterval(() => {
                el.textContent += text[i];
                i++;
                if (i >= text.length) clearInterval(interval);
            }, speed);
        }

    </script>
</body>
</html>